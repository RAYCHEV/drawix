<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>House Drawing Tool</title>
    <meta name="description" content="Professional web application for drawing house plans with walls and windows.">
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
    
    <!-- PDF.js Library -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <script>
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';
    </script>
    
    <!-- Styles -->
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="app-container">
        <!-- Main Content Area -->
        <div class="main-section">
            <header class="app-header">
                <h1 class="app-title">House Drawing Tool</h1>
            </header>
            
            <main class="canvas-container">
                <div class="canvas-wrapper" id="canvasWrapper">
                    <!-- Empty state -->
                    <div class="empty-state" id="emptyState">
                        <p class="empty-state-title">Start drawing your house plan</p>
                        <p class="empty-state-subtitle">Use the tools on the right to draw walls and windows</p>
                    </div>
                    
                    <!-- Loading state -->
                    <div class="loading-state hidden" id="loadingState">
                        <div class="spinner"></div>
                        <span>Loading image...</span>
                    </div>
                    
                    <!-- Canvas -->
                    <canvas id="measurementCanvas" class="measurement-canvas hidden"></canvas>
                    
                    <!-- Zoom controls -->
                    <div class="zoom-controls hidden" id="zoomControls">
                        <button class="zoom-btn" id="zoomOutBtn" data-testid="button-zoom-out" title="Zoom Out">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/><line x1="8" x2="14" y1="11" y2="11"/></svg>
                        </button>
                        <div class="zoom-display">
                            <span id="zoomLevel">100%</span>
                        </div>
                        <button class="zoom-btn" id="zoomInBtn" data-testid="button-zoom-in" title="Zoom In">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="11" cy="11" r="8"/><path d="m21 21-4.3-4.3"/><line x1="8" x2="14" y1="11" y2="11"/><line x1="11" x2="11" y1="8" y2="14"/></svg>
                        </button>
                        <div class="zoom-divider"></div>
                        <button class="zoom-btn" id="resetViewBtn" data-testid="button-reset-view" title="Reset View">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3"/><path d="M21 8V5a2 2 0 0 0-2-2h-3"/><path d="M3 16v3a2 2 0 0 0 2 2h3"/><path d="M16 21h3a2 2 0 0 0 2-2v-3"/></svg>
                        </button>
                    </div>
                </div>
            </main>
        </div>
        
        <!-- Tool Panel -->
        <aside class="tool-panel">
            <!-- Project Name & Screenshot -->
            <div class="panel-section">
                <h2 class="panel-section-title">Project</h2>
                <div class="form-group" style="margin-bottom: 0.75rem;">
                    <label for="projectNameInput" class="form-label" style="font-size: 0.75rem; margin-bottom: 0.375rem;">Project Name</label>
                    <input 
                        type="text" 
                        id="projectNameInput" 
                        class="form-input" 
                        placeholder="Enter project name"
                        style="font-size: 0.875rem; padding: 0.5rem 0.75rem;"
                    >
                </div>
                <button class="control-btn control-btn-primary" id="screenshotBtn" title="Take screenshot with project information">
                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
                    <span>Take Screenshot</span>
                </button>
            </div>
            
            <!-- Tool Selection -->
            <div class="panel-section">
                <h2 class="panel-section-title">Tools</h2>
                <div class="tools-grid">
                    <button class="tool-btn" id="toolSelect" data-tool="select" title="Select Tool - Select and delete elements (A)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 3l7.07 16.97 2.51-7.39 7.39-2.51L3 3z"/></svg>
                        <span>Select (A)</span>
                    </button>
                    <button class="tool-btn active" id="toolWalls" data-tool="walls" title="Walls Tool - Draw parallel lines for walls (W)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
                        <span>Walls (W)</span>
                    </button>
                    <button class="tool-btn" id="toolWindow" data-tool="window" title="Window Tool - Draw windows with technical notation (N)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="2" y="4" width="20" height="16" rx="2"/><line x1="2" y1="8" x2="22" y2="8"/><line x1="2" y1="12" x2="22" y2="12"/><line x1="2" y1="16" x2="22" y2="16"/></svg>
                        <span>Window (N)</span>
                    </button>
                </div>
            </div>
            
            <!-- Controls -->
            <div class="panel-section">
                <h2 class="panel-section-title">Controls</h2>
                <div class="controls-grid">
                    <button class="control-btn control-btn-primary" id="newProjectBtn" title="Start a new project (refresh page)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M12 2v20"/><path d="M2 12h20"/><circle cx="12" cy="12" r="10"/></svg>
                        <span>New Project</span>
                    </button>
                    <button class="control-btn" id="undoBtn" data-testid="button-undo" disabled title="Undo last action (Ctrl+Z / Cmd+Z)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                        <span>Undo (Ctrl+Z)</span>
                    </button>
                    <button class="control-btn control-btn-danger" id="clearBtn" data-testid="button-clear" disabled>
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 6h18"/><path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"/><path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"/></svg>
                        <span>Clear All Drawings</span>
                    </button>
                    <button class="control-btn" id="toggleLengthLabelsBtn" title="Toggle line length labels">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2" ry="2"/><line x1="9" y1="9" x2="15" y2="9"/><line x1="9" y1="15" x2="15" y2="15"/><line x1="12" y1="3" x2="12" y2="21"/></svg>
                        <span>Show Lengths</span>
                    </button>
                    <button class="control-btn" id="toggleAngleSnapBtn" title="Toggle 90-degree angle snapping">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 12 12 3 21 12"/><polyline points="3 21 12 12 21 21"/></svg>
                        <span>90° Snap</span>
                    </button>
                    <button class="control-btn" id="togglePointSnapBtn" title="Toggle point snapping (S)">
                        <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><circle cx="12" cy="12" r="3"/></svg>
                        <span>Point Snap (S)</span>
                    </button>
                </div>
            </div>
            
            <!-- Total Area -->
            <div class="panel-section" id="totalAreaSection">
                <h2 class="panel-section-title">Total Area</h2>
                <div class="info-card">
                    <p class="metric-value" id="totalArea">0.00 m²</p>
                </div>
            </div>
            
            <!-- Polygons List -->
            <div class="panel-section collapsible">
                <button class="collapsible-header" id="polygonsHeader">
                    <h2 class="panel-section-title">Rooms</h2>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="collapsible-content" id="polygonsList">
                    <p class="info-text">No polygons detected</p>
                </div>
            </div>
            
            <!-- Instructions -->
            <div class="panel-section collapsible">
                <button class="collapsible-header" id="instructionsHeader">
                    <h2 class="panel-section-title">Instructions</h2>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="collapsible-content collapsed" id="instructionsContent">
                    <ol class="instructions-list">
                        <li>Use the <strong>Walls</strong> tool to draw walls (2 parallel lines)</li>
                        <li>Use the <strong>Window</strong> tool to draw windows (parallel lines with technical notation)</li>
                        <li>Click to place the first point, then click again to set the direction</li>
                        <li>Enter the desired length in meters when prompted</li>
                        <li>The line will be adjusted to match your input</li>
                        <li>Use the <strong>Select</strong> tool to select and delete elements</li>
                        <li>Use mouse wheel or buttons to zoom</li>
                        <li>Use Shift+drag or right mouse button drag to pan</li>
                    </ol>
                </div>
            </div>
            
            <!-- Keyboard Shortcuts -->
            <div class="panel-section collapsible">
                <button class="collapsible-header" id="shortcutsHeader">
                    <h2 class="panel-section-title">Keyboard Shortcuts</h2>
                    <svg class="chevron" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m6 9 6 6 6-6"/></svg>
                </button>
                <div class="collapsible-content collapsed" id="shortcutsContent">
                    <div class="shortcuts-list">
                        <div class="shortcut-item">
                            <span class="shortcut-key">A</span>
                            <span class="shortcut-description">Activate Select tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">W</span>
                            <span class="shortcut-description">Activate Walls tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">N</span>
                            <span class="shortcut-description">Activate Window tool</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">S</span>
                            <span class="shortcut-description">Toggle Point Snap</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Ctrl+Z / Cmd+Z</span>
                            <span class="shortcut-description">Undo last action</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">Delete / Backspace</span>
                            <span class="shortcut-description">Delete selected elements</span>
                        </div>
                        <div class="shortcut-item">
                            <span class="shortcut-key">ESC</span>
                            <span class="shortcut-description">Cancel drawing or clear selection</span>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
    </div>
    
    <!-- Length Input Modal -->
    <dialog id="lengthModal" class="calibration-modal">
        <div class="modal-content">
            <h2 class="modal-title">Enter Length</h2>
            <p class="modal-description" id="lengthModalDescription">Enter the desired length for the wall/window</p>
            
            <form id="lengthForm" class="calibration-form">
                <div class="form-group">
                    <label for="lengthInput" class="form-label">Length (meters)</label>
                    <input 
                        type="number" 
                        id="lengthInput" 
                        class="form-input" 
                        step="0.01" 
                        min="0.01" 
                        placeholder="e.g., 5.0"
                        required
                        autofocus
                    >
                </div>
                
                <div class="modal-actions">
                    <button type="button" class="btn btn-secondary" id="cancelLengthBtn">
                        Cancel
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Set Length
                    </button>
                </div>
            </form>
        </div>
    </dialog>
    
    <!-- Toast Notification -->
    <div id="toast" class="toast hidden">
        <div class="toast-content">
            <span id="toastMessage"></span>
        </div>
    </div>
    
    <!-- Application Script -->
    <script src="app.js"></script>
</body>
</html>
